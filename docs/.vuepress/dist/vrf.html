<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>WINkLink Verifiable Random Number Service | WINkLink Developer Documentation</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/v2/doc/favicon.ico">
    <meta name="description" content="WINkLink Developer Documentation">
    
    <link rel="preload" href="/v2/doc/assets/css/0.styles.f394efb8.css" as="style"><link rel="preload" href="/v2/doc/assets/js/app.03bfa769.js" as="script"><link rel="preload" href="/v2/doc/assets/js/2.a93bf3eb.js" as="script"><link rel="preload" href="/v2/doc/assets/js/1.449454cc.js" as="script"><link rel="preload" href="/v2/doc/assets/js/23.3063150b.js" as="script"><link rel="prefetch" href="/v2/doc/assets/js/10.16d90ebb.js"><link rel="prefetch" href="/v2/doc/assets/js/11.13c650ee.js"><link rel="prefetch" href="/v2/doc/assets/js/12.55b16c22.js"><link rel="prefetch" href="/v2/doc/assets/js/13.962e7cfd.js"><link rel="prefetch" href="/v2/doc/assets/js/14.cfbd47f4.js"><link rel="prefetch" href="/v2/doc/assets/js/15.4dbeb83f.js"><link rel="prefetch" href="/v2/doc/assets/js/16.35a421bc.js"><link rel="prefetch" href="/v2/doc/assets/js/17.3e08682a.js"><link rel="prefetch" href="/v2/doc/assets/js/18.4faca617.js"><link rel="prefetch" href="/v2/doc/assets/js/19.58a0d499.js"><link rel="prefetch" href="/v2/doc/assets/js/20.55d78c67.js"><link rel="prefetch" href="/v2/doc/assets/js/21.a90ef942.js"><link rel="prefetch" href="/v2/doc/assets/js/22.f1d5d4c6.js"><link rel="prefetch" href="/v2/doc/assets/js/24.c8d68107.js"><link rel="prefetch" href="/v2/doc/assets/js/25.efac722e.js"><link rel="prefetch" href="/v2/doc/assets/js/26.61b32239.js"><link rel="prefetch" href="/v2/doc/assets/js/27.5ec9b61f.js"><link rel="prefetch" href="/v2/doc/assets/js/28.3486a5d3.js"><link rel="prefetch" href="/v2/doc/assets/js/29.1e3aa466.js"><link rel="prefetch" href="/v2/doc/assets/js/3.2d08496e.js"><link rel="prefetch" href="/v2/doc/assets/js/30.5a431eb8.js"><link rel="prefetch" href="/v2/doc/assets/js/31.2e1adf9a.js"><link rel="prefetch" href="/v2/doc/assets/js/32.6525a1e9.js"><link rel="prefetch" href="/v2/doc/assets/js/33.c2ba9b78.js"><link rel="prefetch" href="/v2/doc/assets/js/34.272f28aa.js"><link rel="prefetch" href="/v2/doc/assets/js/35.9390522c.js"><link rel="prefetch" href="/v2/doc/assets/js/36.7749d9ba.js"><link rel="prefetch" href="/v2/doc/assets/js/37.26eb83b6.js"><link rel="prefetch" href="/v2/doc/assets/js/38.a0147385.js"><link rel="prefetch" href="/v2/doc/assets/js/39.396a0113.js"><link rel="prefetch" href="/v2/doc/assets/js/4.2a0c902e.js"><link rel="prefetch" href="/v2/doc/assets/js/40.4e3b23ef.js"><link rel="prefetch" href="/v2/doc/assets/js/41.f0dd511f.js"><link rel="prefetch" href="/v2/doc/assets/js/42.393f4efc.js"><link rel="prefetch" href="/v2/doc/assets/js/43.8564e0ba.js"><link rel="prefetch" href="/v2/doc/assets/js/5.0f6ba89b.js"><link rel="prefetch" href="/v2/doc/assets/js/6.85ab809a.js"><link rel="prefetch" href="/v2/doc/assets/js/7.46648f82.js"><link rel="prefetch" href="/v2/doc/assets/js/vendors~docsearch.5cff1987.js">
    <link rel="stylesheet" href="/v2/doc/assets/css/0.styles.f394efb8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/v2/doc/" class="home-link router-link-active"><!----> <span class="site-name">WINkLink Developer Documentation</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/v2/doc/hk/vrf.html" class="nav-link">
  繁体中文
</a></li><li class="dropdown-item"><!----> <a href="/v2/doc/cn/vrf.html" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/v2/doc/vrf.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/v2/doc/hk/vrf.html" class="nav-link">
  繁体中文
</a></li><li class="dropdown-item"><!----> <a href="/v2/doc/cn/vrf.html" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/v2/doc/vrf.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/v2/doc/" aria-current="page" class="sidebar-link">Introduction to WINkLink</a></li><li><a href="/v2/doc/pricing.html" class="sidebar-link">WINkLink Price Feed Service</a></li><li><a href="/v2/doc/vrf.html" aria-current="page" class="active sidebar-link">WINkLink Verifiable Random Number Service</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/v2/doc/vrf.html#overview" class="sidebar-link">Overview</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/v2/doc/vrf.html#direct-funding-flow" class="sidebar-link">Direct Funding flow</a></li><li class="sidebar-sub-header"><a href="/v2/doc/vrf.html#subscription-flow" class="sidebar-link">Subscription flow</a></li><li class="sidebar-sub-header"><a href="/v2/doc/vrf.html#tron-nile-vrf-contracts" class="sidebar-link">Tron Nile VRF Contracts</a></li><li class="sidebar-sub-header"><a href="/v2/doc/vrf.html#tron-mainnet-vrf-contracts" class="sidebar-link">Tron Mainnet VRF Contracts</a></li></ul></li><li class="sidebar-sub-header"><a href="/v2/doc/vrf.html#how-to-use-existing-winklink-verifiable-random-number-service" class="sidebar-link">How to use existing WINkLink Verifiable Random Number Service</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/v2/doc/vrf.html#vrf-request-process" class="sidebar-link">VRF Request Process</a></li><li class="sidebar-sub-header"><a href="/v2/doc/vrf.html#before-you-start" class="sidebar-link">Before you start</a></li><li class="sidebar-sub-header"><a href="/v2/doc/vrf.html#vrfcoordinatorv2-contract" class="sidebar-link">VRFCoordinatorV2 Contract</a></li><li class="sidebar-sub-header"><a href="/v2/doc/vrf.html#vrfv2wrapper-contract" class="sidebar-link">VRFV2Wrapper Contract</a></li><li class="sidebar-sub-header"><a href="/v2/doc/vrf.html#authorize-a-node-account" class="sidebar-link">Authorize a Node Account</a></li><li class="sidebar-sub-header"><a href="/v2/doc/vrf.html#dapp-contract" class="sidebar-link">Dapp Contract</a></li><li class="sidebar-sub-header"><a href="/v2/doc/vrf.html#dapp-contract-sample" class="sidebar-link">Dapp Contract Sample</a></li></ul></li><li class="sidebar-sub-header"><a href="/v2/doc/vrf.html#how-to-setup-verifiable-random-function-contracts" class="sidebar-link">How to setup Verifiable Random Function Contracts</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/v2/doc/vrf.html#winkmid-contract" class="sidebar-link">WinkMid Contract</a></li><li class="sidebar-sub-header"><a href="/v2/doc/vrf.html#vrfcoordinatorv2" class="sidebar-link">VRFCoordinatorV2</a></li><li class="sidebar-sub-header"><a href="/v2/doc/vrf.html#vrfv2wrapper" class="sidebar-link">VRFV2Wrapper</a></li><li class="sidebar-sub-header"><a href="/v2/doc/vrf.html#consumers" class="sidebar-link">Consumers</a></li></ul></li><li class="sidebar-sub-header"><a href="/v2/doc/vrf.html#how-to-launch-a-verifiable-random-number-service-node" class="sidebar-link">How to launch a Verifiable Random Number Service Node</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/v2/doc/vrf.html#node-deployment" class="sidebar-link">Node Deployment</a></li><li class="sidebar-sub-header"><a href="/v2/doc/vrf.html#prepare-node-account" class="sidebar-link">Prepare Node Account</a></li><li class="sidebar-sub-header"><a href="/v2/doc/vrf.html#required-environment" class="sidebar-link">Required Environment</a></li><li class="sidebar-sub-header"><a href="/v2/doc/vrf.html#node-configuration" class="sidebar-link">Node Configuration</a></li><li class="sidebar-sub-header"><a href="/v2/doc/vrf.html#building-a-docker-image-for-the-node" class="sidebar-link">Building a docker image for the node</a></li><li class="sidebar-sub-header"><a href="/v2/doc/vrf.html#start-a-node-from-source-code" class="sidebar-link">Start a Node from source code</a></li><li class="sidebar-sub-header"><a href="/v2/doc/vrf.html#add-a-vrf-job-to-your-node" class="sidebar-link">Add a VRF Job to Your Node</a></li></ul></li></ul></li><li><a href="/v2/doc/anyapi.html" class="sidebar-link">WINkLink AnyAPI Service</a></li><li><a href="/v2/doc/automation.html" class="sidebar-link">WINkLink Automation Service</a></li><li><a href="/v2/doc/pipeline.html" class="sidebar-link">Pipeline Tasks</a></li><li><a href="/v2/doc/glossary.html" class="sidebar-link">Glossary</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="winklink-verifiable-random-number-service"><a href="#winklink-verifiable-random-number-service" class="header-anchor">#</a> WINkLink Verifiable Random Number Service</h1> <h2 id="overview"><a href="#overview" class="header-anchor">#</a> Overview</h2> <p>Verifiable Random Function (VRF) is the public-key version of a keyed cryptographic hash, which can be used as a random number. Only the holder of the private key can compute the hash, but anyone with the public key can verify the correctness of the hash. VRF can be used to generate secure and reliable random numbers.</p> <p>Random number is determined by seed (provided by users), nonce (private state of VRFCoordinator contract) , block hash (the block of the request event) and private key of oracle node.</p> <p>The generation process of VRF is:</p> <ul><li>A Dapp contract sends out an on-chain request for a random number;</li> <li>Once the off-chain oracle node listens for the request, it generates a random number attaching the cryptographic proof to make the generated random number verifiable, and then submits them back to an oracle contract (VRFCoordinator);</li> <li>Once the random number proof is verified by the oracle contract, the random number is published to the Dapp contract through a callback function.</li></ul> <p>The process above ensures that the random number cannot be tampered with nor manipulated by anyone, including oracle operators, miners, users and even smart contract developers.</p> <p>WINkLink VRF is a provably-fair and verifiable source of randomness designed for Dapp contracts. Dapp contract developers can use WINkLink VRF as a tamper-proof RNG (Random Number Generator) to build reliable smart contracts for any applications which rely on unpredictable random number:</p> <ul><li>Blockchain games and NFTs</li> <li>Random assignment of duties and resources (e.g. randomly assigning judges to cases)</li> <li>Choosing a representative sample for consensus mechanisms</li></ul> <p>The WINkLink VRF solution contains both off-chain and on-chain components:</p> <ul><li>VRF Coordinator (on-chain component): Crafted to interact with the VRF service. It emits an event when a request for randomness is initiated, and then validates the resultant random number and proof of how it was generated by the VRF service.</li> <li>VRF Wrapper (on-chain component): A wrapper for the VRF Coordinator that offers an interface for consuming contracts.</li> <li>VRF service (off-chain node): Listens for requests by subscribing to the VRF Coordinator event logs and calculates a random number based on the block hash and nonce. The VRF service then sends a transaction to the VRFCoordinator including the random number and a proof of how it was generated.</li></ul> <h3 id="direct-funding-flow"><a href="#direct-funding-flow" class="header-anchor">#</a> Direct Funding flow</h3> <p><img src="/v2/doc/assets/img/vrf-direct-funding-flow.c5967464.png" alt="vrf-direct-funding-flow.png"></p> <h3 id="subscription-flow"><a href="#subscription-flow" class="header-anchor">#</a> Subscription flow</h3> <p><img src="/v2/doc/assets/img/vrf-subscription-flow.0e207f09.png" alt="vrf-subscription-flow.png"></p> <h3 id="tron-nile-vrf-contracts"><a href="#tron-nile-vrf-contracts" class="header-anchor">#</a> Tron Nile VRF Contracts</h3> <p>For convenience, Nile testnet has deployed WinkMid contract and encapsulated the WIN token on it. Developers can use this contract address directly without additional deployment. Users can also claim test TRX and WIN tokens from the Faucet address provided by Nile testnet.</p> <table><thead><tr><th style="text-align:left;">Item</th> <th style="text-align:left;">Value</th></tr></thead> <tbody><tr><td style="text-align:left;">WIN Token</td> <td style="text-align:left;">TNDSHKGBmgRx9mDYA9CnxPx55nu672yQw2</td></tr> <tr><td style="text-align:left;">WinkMid</td> <td style="text-align:left;">TLLEKGqhH4MiN541BDaGpXD7MRkwG2mTro</td></tr> <tr><td style="text-align:left;">BlockHashStore</td> <td style="text-align:left;">TBpTbK9KQzagrN7eMKFr5QM2pgZf6FN7KA</td></tr> <tr><td style="text-align:left;">VRFCoordinatorV2</td> <td style="text-align:left;">TDidecxMyGMgqvYS7nmpMQCZ16HqqV5Fke</td></tr> <tr><td style="text-align:left;">VRFV2Wrapper</td> <td style="text-align:left;">TMNRLGXhe3gzbUyWccuQAKhfVKFyqmLE1W</td></tr> <tr><td style="text-align:left;">Fee</td> <td style="text-align:left;">10 WIN</td></tr></tbody></table> <p>Testnet Faucet: <a href="https://nileex.io/join/getJoinPage" target="_blank" rel="noopener noreferrer">https://nileex.io/join/getJoinPage<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="tron-mainnet-vrf-contracts"><a href="#tron-mainnet-vrf-contracts" class="header-anchor">#</a> Tron Mainnet VRF Contracts</h3> <table><thead><tr><th style="text-align:left;">Item</th> <th style="text-align:left;">Value</th></tr></thead> <tbody><tr><td style="text-align:left;">WIN Token</td> <td style="text-align:left;">TLa2f6VPqDgRE67v1736s7bJ8Ray5wYjU7</td></tr> <tr><td style="text-align:left;">WinkMid</td> <td style="text-align:left;">TVMhaFMynYqTRLB1xShYL7wBwdmQHH6bKV</td></tr> <tr><td style="text-align:left;">BlockHashStore</td> <td style="text-align:left;">TRGmef4qUdNJ4xTEL96hToGuMTNst57aS1</td></tr> <tr><td style="text-align:left;">VRFCoordinatorV2</td> <td style="text-align:left;">TZCz1BcnYviUNDiLvG6ZeuC477YupDgDA7</td></tr> <tr><td style="text-align:left;">VRFV2Wrapper</td> <td style="text-align:left;">TGDVwQRKwtNHrwy4RFG49b2HTHkvWckP5N</td></tr> <tr><td style="text-align:left;">Fee</td> <td style="text-align:left;">10 WIN</td></tr></tbody></table> <h2 id="how-to-use-existing-winklink-verifiable-random-number-service"><a href="#how-to-use-existing-winklink-verifiable-random-number-service" class="header-anchor">#</a> How to use existing WINkLink Verifiable Random Number Service</h2> <h3 id="vrf-request-process"><a href="#vrf-request-process" class="header-anchor">#</a> VRF Request Process</h3> <ol><li><p>The Dapp contract invokes the calculateRequestPrice function of VRFV2Wrapper to estimate the total transaction cost required for random number generation.</p></li> <li><p>The Dapp contract calls the transferAndCall function of WinkMid to pay the calculated request price to the Wrapper. This method sends Wink tokens and executes the onTokenTransfer logic of VRFV2Wrapper.</p></li> <li><p>The onTokenTransfer logic of VRFV2Wrapper triggers the requestRandomWords function of VRFCoordinatorV2 to request a random number.</p></li> <li><p>The VRFCoordinatorV2 contract emits the RandomWordsRequested event.</p></li> <li><p>The VRF node captures this event and awaits the specified number of block confirmations. It then returns the random values and proof through the fulfillRandomWords function to the VRFCoordinatorV2 contract.</p></li> <li><p>The VRFCoordinatorV2 contract verifies the proof on the blockchain and subsequently calls back the fulfillRandomWords function of VRFV2Wrapper.</p></li> <li><p>Lastly, the VRFV2Wrapper calls back the Dapp contract to complete the request.</p></li></ol> <h3 id="before-you-start"><a href="#before-you-start" class="header-anchor">#</a> Before you start</h3> <p>Maintainers for WINkLink need to understand how the TRON platform works, and know about smart contract deployment and the process of calling them. You're suggested to read related TRON official documents, particularly those on contract deployment on TronIDE.</p> <p>Prepare the node account. You should read related Node account preparation doc.</p> <h3 id="vrfcoordinatorv2-contract"><a href="#vrfcoordinatorv2-contract" class="header-anchor">#</a> VRFCoordinatorV2 Contract</h3> <p>VRFCoordinatorV2 contract is deployed on the TRON public chain with the following features:</p> <ul><li>Receive random number requests from Dapp contract and emit VRFRequest event</li> <li>WIN transfer as fees, will be sent along with the request</li> <li>Accept random number and the proof submitted from WINkLink node</li> <li>VRFCoordinator contract will verify the proof before sending the random number to Dapp contract</li> <li>Calculate the WINkLink node rewards for the request fulfilment</li></ul> <p>Some parameters are needed in the constructor function when deploying a VRFCoordinator contract:</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">constructor</span><span class="token punctuation">(</span>
<span class="token builtin">address</span> wink<span class="token punctuation">,</span>
<span class="token builtin">address</span> blockhashStore<span class="token punctuation">,</span>
<span class="token builtin">address</span> winkMid
<span class="token punctuation">)</span>
</code></pre></div><p>_<code>blockHashStore</code> BlockHashStore address, _<code>win</code> WIN token address, _<code>winkMid</code> WinkMid contract address.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Nile Testnet</p> <ul><li>WIN TRC20 Contract Address: <code>TNDSHKGBmgRx9mDYA9CnxPx55nu672yQw2</code></li> <li>WinkMid Contract Address: <code>TFbci8j8Ja3hMLPsupsuYcUMsgXniG1TWb</code></li> <li>BlockHashStore Contract Address: <code>TBpTbK9KQzagrN7eMKFr5QM2pgZf6FN7KA</code></li> <li>Testnet Faucet: <a href="https://nileex.io/join/getJoinPage" target="_blank" rel="noopener noreferrer">https://nileex.io/join/getJoinPage<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <h3 id="vrfv2wrapper-contract"><a href="#vrfv2wrapper-contract" class="header-anchor">#</a> VRFV2Wrapper Contract</h3> <p>VRFV2Wrapper streamlining the interaction and allowing direct calls from the Dapp to the VRFCoordinatorV2 contract.</p> <p><strong>Configuration parameters</strong><br> <code>keyHash</code> : Node keyhash<br> <code>maxNumWords</code> : maximum number of random words per vrf request，currently set as 10</p> <h3 id="authorize-a-node-account"><a href="#authorize-a-node-account" class="header-anchor">#</a> Authorize a Node Account</h3> <p>Node account needs authorization to submit data to VRFCoordinatorV2 contract, otherwise error will be reported.</p> <p>The owner of the VRFCoordinatorV2 contract is required to call the contract below and add the node account to the whitelist:</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">registerProvingKey</span><span class="token punctuation">(</span><span class="token builtin">address</span> oracle<span class="token punctuation">,</span> <span class="token builtin">uint256</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token keyword">calldata</span> publicProvingKey<span class="token punctuation">)</span> <span class="token keyword">external</span> onlyOwner
</code></pre></div><p>_<code>oracle</code> is the address of the registered node, which is used to receive the WIN token paid by DAPP , _<code>publicProvingKey</code> is the public key used by the registration node to generate random numbers,</p> <p>Call example:</p> <div class="language- extra-class"><pre class="language-text"><code>registerProvingKey(TYmwSFuFuiDZCtYsRFKCNr25byeqHH7Esb,['6273228386041830135141271310112248407537170435188969735053134748570771583756',67273502359025519559461602732298865784327759914690240925031700564257821594585'])
</code></pre></div><h3 id="dapp-contract"><a href="#dapp-contract" class="header-anchor">#</a> Dapp Contract</h3> <p>Main steps to set up your consuming contract：</p> <ul><li>a) Import and inherit <code>VRFV2WrapperConsumerBase</code></li></ul> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token comment">// SPDX-License-Identifier: MIT</span>
<span class="token comment">// An example of a consumer contract that directly pays for each request.</span>
<span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.8.7</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">&quot;./VRFV2WrapperConsumerBase.sol&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">VRFv2DirectFundingConsumer</span> <span class="token keyword">is</span> VRFV2WrapperConsumerBase<span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><ul><li>b) Contract must implement the fulfillRandomWords function, which is the callback VRF function. Here, you add logic to handle the random values after they are returned to your contract.</li></ul> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">fulfillRandomWords</span><span class="token punctuation">(</span>
<span class="token builtin">uint256</span> _requestId<span class="token punctuation">,</span>
<span class="token builtin">uint256</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">memory</span> _randomWords
<span class="token punctuation">)</span>
</code></pre></div><ul><li>c) Contract invoke requestRandomness function to trigger a VRF request.</li></ul> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">requestRandomWords</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">external</span>
onlyOwner
<span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint256</span> requestId<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  requestId <span class="token operator">=</span> <span class="token function">requestRandomness</span><span class="token punctuation">(</span>
  msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span>
  callbackGasLimit<span class="token punctuation">,</span>
  requestConfirmations<span class="token punctuation">,</span>
  numWords
<span class="token punctuation">)</span><span class="token punctuation">;</span>
s_requests<span class="token punctuation">[</span>requestId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">RequestStatus</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  paid<span class="token punctuation">:</span> VRF_V2_WRAPPER<span class="token punctuation">.</span><span class="token function">calculateRequestPrice</span><span class="token punctuation">(</span>callbackGasLimit<span class="token punctuation">,</span> numWords<span class="token punctuation">)</span><span class="token punctuation">,</span>
  randomWords<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">uint256</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  fulfilled<span class="token punctuation">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
requestIds<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>requestId<span class="token punctuation">)</span><span class="token punctuation">;</span>
lastRequestId <span class="token operator">=</span> requestId<span class="token punctuation">;</span>
<span class="token keyword">emit</span> <span class="token function">RequestSent</span><span class="token punctuation">(</span>requestId<span class="token punctuation">,</span> numWords<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> requestId<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="dapp-contract-sample"><a href="#dapp-contract-sample" class="header-anchor">#</a> Dapp Contract Sample</h3> <p>Deploy sample consumer contract VRFv2DirectFundingConsumer.sol。</p> <p>Constructor parameters：<br> <code>_winkAddress</code>：wink token contract address<br> <code>_winkMid</code>： winkMid contract address<br> <code>_wrapper</code>：VRFV2Wrapper contract address<br> <code>_numWords</code>： number of random words per vrf request</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token comment">// SPDX-License-Identifier: MIT</span>
<span class="token comment">// An example of a consumer contract that directly pays for each request.</span>
<span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.8.7</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">&quot;./ConfirmedOwner.sol&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;./VRFV2WrapperConsumerBase.sol&quot;</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * THIS IS AN EXAMPLE CONTRACT THAT USES HARDCODED VALUES FOR CLARITY.
 * THIS IS AN EXAMPLE CONTRACT THAT USES UN-AUDITED CODE.
 * DO NOT USE THIS CODE IN PRODUCTION.
 */</span>

<span class="token keyword">contract</span> <span class="token class-name">VRFv2DirectFundingConsumer</span> <span class="token keyword">is</span>
VRFV2WrapperConsumerBase<span class="token punctuation">,</span>
ConfirmedOwner
<span class="token punctuation">{</span>
    <span class="token builtin">address</span> winkAddress<span class="token punctuation">;</span>

    <span class="token keyword">event</span> <span class="token function">RequestSent</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> requestId<span class="token punctuation">,</span> <span class="token builtin">uint32</span> numWords<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">event</span> <span class="token function">RequestFulfilled</span><span class="token punctuation">(</span>
        <span class="token builtin">uint256</span> requestId<span class="token punctuation">,</span>
        <span class="token builtin">uint256</span><span class="token punctuation">[</span><span class="token punctuation">]</span> randomWords<span class="token punctuation">,</span>
        <span class="token builtin">uint256</span> payment
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">struct</span> <span class="token class-name">RequestStatus</span> <span class="token punctuation">{</span>
        <span class="token builtin">uint256</span> paid<span class="token punctuation">;</span> <span class="token comment">// amount paid in wink</span>
        <span class="token builtin">bool</span> fulfilled<span class="token punctuation">;</span> <span class="token comment">// whether the request has been successfully fulfilled</span>
        <span class="token builtin">uint256</span><span class="token punctuation">[</span><span class="token punctuation">]</span> randomWords<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">mapping</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> <span class="token operator">=&gt;</span> RequestStatus<span class="token punctuation">)</span>
    <span class="token keyword">public</span> s_requests<span class="token punctuation">;</span> <span class="token comment">/* requestId --&gt; requestStatus */</span>

    <span class="token comment">// past requests Id.</span>
    <span class="token builtin">uint256</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">public</span> requestIds<span class="token punctuation">;</span>
    <span class="token builtin">uint256</span> <span class="token keyword">public</span> lastRequestId<span class="token punctuation">;</span>

    <span class="token comment">// Depends on the number of requested values that you want sent to the</span>
    <span class="token comment">// fulfillRandomWords() function. Test and adjust</span>
    <span class="token comment">// this limit based on the network that you select, the size of the request,</span>
    <span class="token comment">// and the processing of the callback request in the fulfillRandomWords()</span>
    <span class="token comment">// function.</span>
    <span class="token builtin">uint32</span> callbackGasLimit <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment">// The default is 3, but you can set this higher.</span>
    <span class="token builtin">uint16</span> requestConfirmations <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>

    <span class="token comment">// For this example, retrieve 2 random values in one request.</span>
    <span class="token comment">// Cannot exceed VRFV2Wrapper.getConfig().maxNumWords.</span>
    <span class="token builtin">uint32</span> numWords<span class="token punctuation">;</span>

    <span class="token keyword">constructor</span><span class="token punctuation">(</span>
        <span class="token builtin">address</span> _winkAddress<span class="token punctuation">,</span>
        <span class="token builtin">address</span> _winkMid<span class="token punctuation">,</span>
        <span class="token builtin">address</span> _wrapper<span class="token punctuation">,</span>
        <span class="token builtin">uint32</span> _numWords
    <span class="token punctuation">)</span>
    <span class="token function">ConfirmedOwner</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">)</span>
    <span class="token function">VRFV2WrapperConsumerBase</span><span class="token punctuation">(</span>_winkAddress<span class="token punctuation">,</span> _winkMid<span class="token punctuation">,</span> _wrapper<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        winkAddress <span class="token operator">=</span> _winkAddress<span class="token punctuation">;</span>
        numWords <span class="token operator">=</span> _numWords<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">requestRandomWords</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">external</span>
    onlyOwner
    <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint256</span> requestId<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        requestId <span class="token operator">=</span> <span class="token function">requestRandomness</span><span class="token punctuation">(</span>
            callbackGasLimit<span class="token punctuation">,</span>
            requestConfirmations<span class="token punctuation">,</span>
            numWords
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        s_requests<span class="token punctuation">[</span>requestId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">RequestStatus</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            paid<span class="token punctuation">:</span> VRF_V2_WRAPPER<span class="token punctuation">.</span><span class="token function">calculateRequestPrice</span><span class="token punctuation">(</span>callbackGasLimit<span class="token punctuation">,</span> numWords<span class="token punctuation">)</span><span class="token punctuation">,</span>
            randomWords<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">uint256</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            fulfilled<span class="token punctuation">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        requestIds<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>requestId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        lastRequestId <span class="token operator">=</span> requestId<span class="token punctuation">;</span>
        <span class="token keyword">emit</span> <span class="token function">RequestSent</span><span class="token punctuation">(</span>requestId<span class="token punctuation">,</span> numWords<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> requestId<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">fulfillRandomWords</span><span class="token punctuation">(</span>
        <span class="token builtin">uint256</span> _requestId<span class="token punctuation">,</span>
        <span class="token builtin">uint256</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">memory</span> _randomWords
    <span class="token punctuation">)</span> <span class="token keyword">internal</span> override <span class="token punctuation">{</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>s_requests<span class="token punctuation">[</span>_requestId<span class="token punctuation">]</span><span class="token punctuation">.</span>paid <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;request not found&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        s_requests<span class="token punctuation">[</span>_requestId<span class="token punctuation">]</span><span class="token punctuation">.</span>fulfilled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        s_requests<span class="token punctuation">[</span>_requestId<span class="token punctuation">]</span><span class="token punctuation">.</span>randomWords <span class="token operator">=</span> _randomWords<span class="token punctuation">;</span>
        <span class="token keyword">emit</span> <span class="token function">RequestFulfilled</span><span class="token punctuation">(</span>
            _requestId<span class="token punctuation">,</span>
            _randomWords<span class="token punctuation">,</span>
            s_requests<span class="token punctuation">[</span>_requestId<span class="token punctuation">]</span><span class="token punctuation">.</span>paid
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">getRequestStatus</span><span class="token punctuation">(</span>
        <span class="token builtin">uint256</span> _requestId
    <span class="token punctuation">)</span>
    <span class="token keyword">external</span>
    <span class="token keyword">view</span>
    <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint256</span> paid<span class="token punctuation">,</span> <span class="token builtin">bool</span> fulfilled<span class="token punctuation">,</span> <span class="token builtin">uint256</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">memory</span> randomWords<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>s_requests<span class="token punctuation">[</span>_requestId<span class="token punctuation">]</span><span class="token punctuation">.</span>paid <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;request not found&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        RequestStatus <span class="token keyword">memory</span> request <span class="token operator">=</span> s_requests<span class="token punctuation">[</span>_requestId<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>paid<span class="token punctuation">,</span> request<span class="token punctuation">.</span>fulfilled<span class="token punctuation">,</span> request<span class="token punctuation">.</span>randomWords<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token comment">// SPDX-License-Identifier: MIT</span>
<span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.8.0</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">&quot;./ConfirmedOwnerWithProposal.sol&quot;</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @title The ConfirmedOwner contract
 * @notice A contract with helpers for basic contract ownership.
 */</span>
<span class="token keyword">contract</span> <span class="token class-name">ConfirmedOwner</span> <span class="token keyword">is</span> ConfirmedOwnerWithProposal <span class="token punctuation">{</span>
    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token builtin">address</span> newOwner<span class="token punctuation">)</span> <span class="token function">ConfirmedOwnerWithProposal</span><span class="token punctuation">(</span>newOwner<span class="token punctuation">,</span> <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token comment">// SPDX-License-Identifier: MIT</span>
<span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.8.0</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">&quot;./OwnableInterface.sol&quot;</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @title The ConfirmedOwner contract
 * @notice A contract with helpers for basic contract ownership.
 */</span>
<span class="token keyword">contract</span> <span class="token class-name">ConfirmedOwnerWithProposal</span> <span class="token keyword">is</span> OwnableInterface <span class="token punctuation">{</span>
    <span class="token builtin">address</span> <span class="token keyword">private</span> s_owner<span class="token punctuation">;</span>
    <span class="token builtin">address</span> <span class="token keyword">private</span> s_pendingOwner<span class="token punctuation">;</span>

    <span class="token keyword">event</span> <span class="token function">OwnershipTransferRequested</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token keyword">indexed</span> <span class="token keyword">from</span><span class="token punctuation">,</span> <span class="token builtin">address</span> <span class="token keyword">indexed</span> to<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">event</span> <span class="token function">OwnershipTransferred</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token keyword">indexed</span> <span class="token keyword">from</span><span class="token punctuation">,</span> <span class="token builtin">address</span> <span class="token keyword">indexed</span> to<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token builtin">address</span> newOwner<span class="token punctuation">,</span> <span class="token builtin">address</span> pendingOwner<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>newOwner <span class="token operator">!=</span> <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Cannot set owner to zero&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        s_owner <span class="token operator">=</span> newOwner<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pendingOwner <span class="token operator">!=</span> <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">_transferOwnership</span><span class="token punctuation">(</span>pendingOwner<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * @notice Allows an owner to begin transferring ownership to a new address,
   * pending.
   */</span>
    <span class="token keyword">function</span> <span class="token function">transferOwnership</span><span class="token punctuation">(</span><span class="token builtin">address</span> to<span class="token punctuation">)</span> <span class="token keyword">public</span> override onlyOwner <span class="token punctuation">{</span>
        <span class="token function">_transferOwnership</span><span class="token punctuation">(</span>to<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * @notice Allows an ownership transfer to be completed by the recipient.
   */</span>
    <span class="token keyword">function</span> <span class="token function">acceptOwnership</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">external</span> override <span class="token punctuation">{</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender <span class="token operator">==</span> s_pendingOwner<span class="token punctuation">,</span> <span class="token string">&quot;Must be proposed owner&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token builtin">address</span> oldOwner <span class="token operator">=</span> s_owner<span class="token punctuation">;</span>
        s_owner <span class="token operator">=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span>
        s_pendingOwner <span class="token operator">=</span> <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">emit</span> <span class="token function">OwnershipTransferred</span><span class="token punctuation">(</span>oldOwner<span class="token punctuation">,</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * @notice Get the current owner
   */</span>
    <span class="token keyword">function</span> <span class="token function">owner</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">view</span> override <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> s_owner<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * @notice validate, transfer ownership, and emit relevant events
   */</span>
    <span class="token keyword">function</span> <span class="token function">_transferOwnership</span><span class="token punctuation">(</span><span class="token builtin">address</span> to<span class="token punctuation">)</span> <span class="token keyword">private</span> <span class="token punctuation">{</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>to <span class="token operator">!=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> <span class="token string">&quot;Cannot transfer to self&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        s_pendingOwner <span class="token operator">=</span> to<span class="token punctuation">;</span>

        <span class="token keyword">emit</span> <span class="token function">OwnershipTransferRequested</span><span class="token punctuation">(</span>s_owner<span class="token punctuation">,</span> to<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * @notice validate access
   */</span>
    <span class="token keyword">function</span> <span class="token function">_validateOwnership</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">internal</span> <span class="token keyword">view</span> <span class="token punctuation">{</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender <span class="token operator">==</span> s_owner<span class="token punctuation">,</span> <span class="token string">&quot;Only callable by owner&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * @notice Reverts if called by anyone other than the contract owner.
   */</span>
    <span class="token keyword">modifier</span> <span class="token function">onlyOwner</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">_validateOwnership</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">_</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token comment">// SPDX-License-Identifier: MIT</span>
<span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.8.0</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">OwnableInterface</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">owner</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">transferOwnership</span><span class="token punctuation">(</span><span class="token builtin">address</span> recipient<span class="token punctuation">)</span> <span class="token keyword">external</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">acceptOwnership</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">external</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token comment">// SPDX-License-Identifier: MIT</span>
<span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.8.0</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">&quot;./TRC20Interface.sol&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;./VRFV2WrapperInterface.sol&quot;</span><span class="token punctuation">;</span>

<span class="token comment">/** *******************************************************************************
 * @notice Interface for contracts using VRF randomness through the VRF V2 wrapper
 * ********************************************************************************
 * @dev PURPOSE
 *
 * @dev Create VRF V2 requests without the need for subscription management. Rather than creating
 * @dev and funding a VRF V2 subscription, a user can use this wrapper to create one off requests,
 * @dev paying up front rather than at fulfillment.
 *
 * @dev Since the price is determined using the gas price of the request transaction rather than
 * @dev the fulfillment transaction, the wrapper charges an additional premium on callback gas
 * @dev usage, in addition to some extra overhead costs associated with the VRFV2Wrapper contract.
 * *****************************************************************************
 * @dev USAGE
 *
 * @dev Calling contracts must inherit from VRFV2WrapperConsumerBase. The consumer must be funded
 * @dev with enough WINK to make the request, otherwise requests will revert. To request randomness,
 * @dev call the 'requestRandomness' function with the desired VRF parameters. This function handles
 * @dev paying for the request based on the current pricing.
 *
 * @dev Consumers must implement the fullfillRandomWords function, which will be called during
 * @dev fulfillment with the randomness result.
 */</span>
abstract <span class="token keyword">contract</span> <span class="token class-name">VRFV2WrapperConsumerBase</span> <span class="token punctuation">{</span>
    TRC20Interface <span class="token keyword">internal</span> immutable WINK_TOKEN<span class="token punctuation">;</span>
    WinkMid <span class="token keyword">internal</span> immutable WINK_MID<span class="token punctuation">;</span>
    VRFV2WrapperInterface <span class="token keyword">internal</span> immutable VRF_V2_WRAPPER<span class="token punctuation">;</span>

    <span class="token comment">/**
     * @param _winkMid is the address of WinkMid
   * @param _vrfV2Wrapper is the address of the VRFV2Wrapper contract
   */</span>
    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token builtin">address</span> _wink<span class="token punctuation">,</span> <span class="token builtin">address</span> _winkMid<span class="token punctuation">,</span> <span class="token builtin">address</span> _vrfV2Wrapper<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        WINK_TOKEN <span class="token operator">=</span> <span class="token function">TRC20Interface</span><span class="token punctuation">(</span>_wink<span class="token punctuation">)</span><span class="token punctuation">;</span>
        WINK_MID <span class="token operator">=</span> <span class="token function">WinkMid</span><span class="token punctuation">(</span>_winkMid<span class="token punctuation">)</span><span class="token punctuation">;</span>
        VRF_V2_WRAPPER <span class="token operator">=</span> <span class="token function">VRFV2WrapperInterface</span><span class="token punctuation">(</span>_vrfV2Wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * @dev Requests randomness from the VRF V2 wrapper.
   *
   * @param _callbackGasLimit is the gas limit that should be used when calling the consumer's
   *        fulfillRandomWords function.
   * @param _requestConfirmations is the number of confirmations to wait before fulfilling the
   *        request. A higher number of confirmations increases security by reducing the likelihood
   *        that a chain re-org changes a published randomness outcome.
   * @param _numWords is the number of random words to request.
   *
   * @return requestId is the VRF V2 request ID of the newly created randomness request.
   */</span>
    <span class="token keyword">function</span> <span class="token function">requestRandomness</span><span class="token punctuation">(</span>
        <span class="token builtin">uint32</span> _callbackGasLimit<span class="token punctuation">,</span>
        <span class="token builtin">uint16</span> _requestConfirmations<span class="token punctuation">,</span>
        <span class="token builtin">uint32</span> _numWords
    <span class="token punctuation">)</span> <span class="token keyword">internal</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint256</span> requestId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin">uint64</span> amount <span class="token operator">=</span> VRF_V2_WRAPPER<span class="token punctuation">.</span><span class="token function">calculateRequestPrice</span><span class="token punctuation">(</span>_callbackGasLimit<span class="token punctuation">,</span> _numWords<span class="token punctuation">)</span><span class="token punctuation">;</span>
        WINK_TOKEN<span class="token punctuation">.</span><span class="token function">approve</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span>WINK_MID<span class="token punctuation">)</span><span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        WINK_MID<span class="token punctuation">.</span><span class="token function">transferAndCall</span><span class="token punctuation">(</span>
            <span class="token builtin">address</span><span class="token punctuation">(</span>VRF_V2_WRAPPER<span class="token punctuation">)</span><span class="token punctuation">,</span>
            amount<span class="token punctuation">,</span>
            abi<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>_callbackGasLimit<span class="token punctuation">,</span> _requestConfirmations<span class="token punctuation">,</span> _numWords<span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> VRF_V2_WRAPPER<span class="token punctuation">.</span><span class="token function">lastRequestId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * @notice fulfillRandomWords handles the VRF V2 wrapper response. The consuming contract must
   * @notice implement it.
   *
   * @param _requestId is the VRF V2 request ID.
   * @param _randomWords is the randomness result.
   */</span>
    <span class="token keyword">function</span> <span class="token function">fulfillRandomWords</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> _requestId<span class="token punctuation">,</span> <span class="token builtin">uint256</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">memory</span> _randomWords<span class="token punctuation">)</span> <span class="token keyword">internal</span> virtual<span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">rawFulfillRandomWords</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> _requestId<span class="token punctuation">,</span> <span class="token builtin">uint256</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">memory</span> _randomWords<span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token punctuation">{</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender <span class="token operator">==</span> <span class="token builtin">address</span><span class="token punctuation">(</span>VRF_V2_WRAPPER<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;only VRF V2 wrapper can fulfill&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">fulfillRandomWords</span><span class="token punctuation">(</span>_requestId<span class="token punctuation">,</span> _randomWords<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token comment">// SPDX-License-Identifier: MIT</span>
<span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.8.0</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">VRFV2WrapperInterface</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * @return the request ID of the most recent VRF V2 request made by this wrapper. This should only
   * be relied option within the same transaction that the request was made.
   */</span>
    <span class="token keyword">function</span> <span class="token function">lastRequestId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">view</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint256</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * @notice Calculates the price of a VRF request with the given callbackGasLimit at the current
   * @notice block.
   *
   * @dev This function relies on the transaction gas price which is not automatically set during
   * @dev simulation. To estimate the price at a specific gas price, use the estimatePrice function.
   *
   * @param _callbackGasLimit is the gas limit used to estimate the price.
   */</span>
    <span class="token keyword">function</span> <span class="token function">calculateRequestPrice</span><span class="token punctuation">(</span><span class="token builtin">uint32</span> _callbackGasLimit<span class="token punctuation">,</span> <span class="token builtin">uint32</span> _numWords<span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">view</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//   /**</span>
    <span class="token comment">//   * @notice Estimates the price of a VRF request with a specific gas limit and gas price.</span>
    <span class="token comment">//   *</span>
    <span class="token comment">//   * @dev This is a convenience function that can be called in simulation to better understand</span>
    <span class="token comment">//   * @dev pricing.</span>
    <span class="token comment">//   *</span>
    <span class="token comment">//   * @param _callbackGasLimit is the gas limit used to estimate the price.</span>
    <span class="token comment">//   * @param _requestGasPriceWei is the gas price in wei used for the estimation.</span>
    <span class="token comment">//   */</span>
    <span class="token comment">//   function estimateRequestPrice(uint32 _callbackGasLimit, uint256 _requestGasPriceWei) external view returns (uint256);</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token comment">// SPDX-License-Identifier: MIT</span>
<span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.8.0</span><span class="token punctuation">;</span>

abstract <span class="token keyword">contract</span> <span class="token class-name">TRC20Interface</span> <span class="token punctuation">{</span>

    <span class="token keyword">function</span> <span class="token function">totalSupply</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">view</span> virtual <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">balanceOf</span><span class="token punctuation">(</span><span class="token builtin">address</span> guy<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">view</span> virtual <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">allowance</span><span class="token punctuation">(</span><span class="token builtin">address</span> src<span class="token punctuation">,</span> <span class="token builtin">address</span> guy<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">view</span> virtual <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">approve</span><span class="token punctuation">(</span><span class="token builtin">address</span> guy<span class="token punctuation">,</span> <span class="token builtin">uint</span> wad<span class="token punctuation">)</span> <span class="token keyword">public</span>  virtual <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token builtin">address</span> dst<span class="token punctuation">,</span> <span class="token builtin">uint</span> wad<span class="token punctuation">)</span> <span class="token keyword">public</span> virtual <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">transferFrom</span><span class="token punctuation">(</span><span class="token builtin">address</span> src<span class="token punctuation">,</span> <span class="token builtin">address</span> dst<span class="token punctuation">,</span> <span class="token builtin">uint</span> wad<span class="token punctuation">)</span> <span class="token keyword">public</span> virtual <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">event</span> <span class="token function">Transfer</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token keyword">indexed</span> <span class="token keyword">from</span><span class="token punctuation">,</span> <span class="token builtin">address</span> <span class="token keyword">indexed</span> to<span class="token punctuation">,</span> <span class="token builtin">uint</span> tokens<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">event</span> <span class="token function">Approval</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token keyword">indexed</span> tokenOwner<span class="token punctuation">,</span> <span class="token builtin">address</span> <span class="token keyword">indexed</span> spender<span class="token punctuation">,</span> <span class="token builtin">uint</span> tokens<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

abstract <span class="token keyword">contract</span> <span class="token class-name">WinkMid</span> <span class="token punctuation">{</span>

    <span class="token keyword">function</span> <span class="token function">setToken</span><span class="token punctuation">(</span><span class="token builtin">address</span> tokenAddress<span class="token punctuation">)</span> <span class="token keyword">public</span> virtual<span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">transferAndCall</span><span class="token punctuation">(</span><span class="token builtin">address</span> to<span class="token punctuation">,</span> <span class="token builtin">uint64</span> tokens<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">calldata</span> _data<span class="token punctuation">)</span> <span class="token keyword">public</span> virtual <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span> success<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">balanceOf</span><span class="token punctuation">(</span><span class="token builtin">address</span> guy<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">view</span> virtual <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">allowance</span><span class="token punctuation">(</span><span class="token builtin">address</span> src<span class="token punctuation">,</span> <span class="token builtin">address</span> guy<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">view</span> virtual <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><h2 id="how-to-setup-verifiable-random-function-contracts"><a href="#how-to-setup-verifiable-random-function-contracts" class="header-anchor">#</a> How to setup Verifiable Random Function Contracts</h2> <h3 id="winkmid-contract"><a href="#winkmid-contract" class="header-anchor">#</a> WinkMid Contract</h3> <p>WINkLink uses WIN (TRC20) as the base token for the whole platform.</p> <p>WINkLink adopts the <code>transferAndCall</code> feature, i.e. calling one of the callback functions while transferring <code>TRC20</code> tokens to contracts, a feature similar to <code>ERC677</code> yet adopting different interface parameters.</p> <p>Given that we cannot modify contracts or add interfaces for most of the tokens issued, WINkLink provides WinkMid wrapper contract, which helps wrapping any TRC20 token and provides transferAndCall interface.</p> <p>The contract code is available at <code>WinkMid.sol</code>.</p> <p>For convenience, Nile TestNet has deployed WinkMid contract and encapsulated the WIN token on it. Developers may use this contract address directly without additional deployment. Users may also claim test TRX and WIN tokens from the Faucet address provided by Nile TestNet.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Nile Testnet</p> <p>WIN TRC20 Contract Address: TNDSHKGBmgRx9mDYA9CnxPx55nu672yQw2</p> <p>WinkMid Contract Address: TJpkay8rJXUWhvS2uL5AmMwFspQdHCX1rw</p> <p>Testnet Faucet: <a href="https://nileex.io/join/getJoinPage" target="_blank" rel="noopener noreferrer">https://nileex.io/join/getJoinPage<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <p>When deploying WinkMid contract, developers need to provide the encapsulated <code>TRC20</code> token address (i.e. WIN token address) for the constructor.</p> <p>Developers do not need to call WinkMid contract directly, as it's wink a helper for caller contracts.</p> <p>WIN token address and WinkMid contract address are needed in the constructor function when deploying an Coordinator contract.</p> <h3 id="vrfcoordinatorv2"><a href="#vrfcoordinatorv2" class="header-anchor">#</a> VRFCoordinatorV2</h3> <p>The coordinator is the main contract that handles all VRF requests and fulfillments. Deploy the contract with respective arguments.</p> <p>Oracle must register its node address in <code>base58</code> with the proving keys to the coordinator before initiating requests, otherwise requests will fail.</p> <h3 id="vrfv2wrapper"><a href="#vrfv2wrapper" class="header-anchor">#</a> VRFV2Wrapper</h3> <p>The wrapper contract acts as an access layer for direct funding consumers, topup sufficient wink to subscription for internal circulation using WinkMid’s <code>transferAndCall</code>.</p> <p>Data passed in to be abi encoded subsctiption ID value i.e. <code>0x0000000000000000000000000000000000000000000000000000000000000007</code> for sub id = 7)</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>keyhash refers to the oracle node’s keyhash, it can be obtained through Operator UI or CLI</p></div> <h3 id="consumers"><a href="#consumers" class="header-anchor">#</a> Consumers</h3> <ul><li><p>VRFv2DirectFundingConsumer</p> <p>Direct funding consumer directly debits Wink tokens from user’s account on request. This consumer interfaces with the wrapper contract for requests.</p></li> <li><p>VRFv2SubscriptionConsumer</p> <p>Subscription consumer requires a subscription manager to maintain an active subscription. This consumer interfaces directly with the coordinator contract using a valid subscription id for requests.</p></li></ul> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>The consumer contracts provided in the code is a working sample, users are expected to write their own consumer contracts based on their use cases.</p></div> <h2 id="how-to-launch-a-verifiable-random-number-service-node"><a href="#how-to-launch-a-verifiable-random-number-service-node" class="header-anchor">#</a> How to launch a Verifiable Random Number Service Node</h2> <h3 id="node-deployment"><a href="#node-deployment" class="header-anchor">#</a> Node Deployment</h3> <p>WINkLink node can be deployed after the contract is deployed.</p> <p>WINkLink node (project directory node) code is available at: <a href="https://github.com/tron-oracle/winklink-2.0/tree/main" target="_blank" rel="noopener noreferrer">https://github.com/tron-oracle/winklink-2.0/tree/main<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Current node implementation includes the adapter for accessing token price via exchange APIs. Please run the node in a stable network environment outside Mainland China.</p></div> <h3 id="prepare-node-account"><a href="#prepare-node-account" class="header-anchor">#</a> Prepare Node Account</h3> <p>Each WINkLink node must be linked to a TRON account for calling Aggregator contract to transmit data.</p> <p>After generating the account address and the private key, the developer can test TRX token on the Testnet Faucet page.The token is used for paying the handling fees on calling the smart contracts.</p> <p>Account will be generated on the initial run of the node and the private key will be stored in the keychain. Node will use this account for price feed transmissions.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>account generated is not activated, please transfer any amount of TRX into the account for activation</p></div> <h3 id="required-environment"><a href="#required-environment" class="header-anchor">#</a> Required Environment</h3> <p>WINkLink node relies on a running PostgreSQL database. Developers can find more information in the official documentation https://www.postgresql.org .</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Here we assume that the username and the password for the PostgreSQL instance deployed locally are root:root respectively. Please use a strong password or other verification methods in the production environment.</p></div> <p>WINkLink node is written in Go programming language and requires Golang environment.</p> <h3 id="node-configuration"><a href="#node-configuration" class="header-anchor">#</a> Node Configuration</h3> <p>WINkLink node is configured using TOML files. Main config is tools/config/config.toml. With secrets.toml you can specify a db instance to be used. Below is a sample template for reference.</p> <div class="language-toml extra-class"><pre class="language-toml"><code><span class="token comment"># secrets.toml</span>
<span class="token punctuation">[</span><span class="token table class-name">Database</span><span class="token punctuation">]</span>
<span class="token key property">URL</span> <span class="token punctuation">=</span> <span class="token string">'postgresql://root:root@localhost:5432/winklink?sslmode=disable'</span> <span class="token comment"># Require</span>
<span class="token key property">AllowSimplePasswords</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>

<span class="token punctuation">[</span><span class="token table class-name">Password</span><span class="token punctuation">]</span>
<span class="token key property">Keystore</span> <span class="token punctuation">=</span> <span class="token string">'keystorePassword'</span> <span class="token comment"># Required</span>

<span class="token punctuation">[</span><span class="token table class-name">Tron</span><span class="token punctuation">]</span>
<span class="token key property">TronApiKey</span> <span class="token punctuation">=</span> <span class="token string">'apiKey'</span>
</code></pre></div><p>After the node configuration file is confirmed, it is required to create <code>vrfpassword</code> and <code>apicredentials</code> files and write the userid and password to access the node’s api:</p> <div class="language-toml extra-class"><pre class="language-toml"><code><span class="token comment"># apicredentials</span>
example<span class="token punctuation">.</span>user@fake<span class="token punctuation">.</span>email
totallyNotFakePassword (<span class="token number">16</span> characters long)
</code></pre></div><div class="language-toml extra-class"><pre class="language-toml"><code><span class="token comment"># vrfpassword</span>
totallyNotFakePassword (<span class="token number">16</span> characters long)
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>It is important that you keep private information safe.</p></div> <h3 id="building-a-docker-image-for-the-node"><a href="#building-a-docker-image-for-the-node" class="header-anchor">#</a> Building a docker image for the node</h3> <p>Use the following command to build a standard linux docker image:</p> <div class="language- extra-class"><pre class="language-text"><code># build a docker image
docker buildx build --platform linux/amd64 -t winklink-2.0 -f core/winklink.Dockerfile .
</code></pre></div><p>After building, we can tag and push it to the desired repository for deployment.</p> <h3 id="start-a-node-from-source-code"><a href="#start-a-node-from-source-code" class="header-anchor">#</a> Start a Node from source code</h3> <p>Install <a href="https://go.dev/dl/" target="_blank" rel="noopener noreferrer">go1.20<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Go into the base directory of the source code winklink-2.0</p> <p>Build the command line interface with</p> <div class="language- extra-class"><pre class="language-text"><code>make install
</code></pre></div><p>Start your WINkLink node using the following command with the respective configuration items:</p> <div class="language- extra-class"><pre class="language-text"><code>winklink -c /tools/config/config.toml -s /tools/config/secrets.toml node start -p /tools/secrets/vrfpassword -a /tools/secrets/apicredentials
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Your node account must have enough TRX tokens for contract calls. You can apply testnet tokens at Testnet Faucet.</p></div> <h3 id="add-a-vrf-job-to-your-node"><a href="#add-a-vrf-job-to-your-node" class="header-anchor">#</a> Add a VRF Job to Your Node</h3> <p>Below is an example template of the bare minimal parameters required to create a VRF job spec.</p> <div class="language-json extra-class"><pre class="language-json"><code>type = <span class="token string">&quot;vrf&quot;</span>
schemaVersion = <span class="token number">1</span>
name = <span class="token string">&quot;vrf-delete-test&quot;</span>
forwardingAllowed = <span class="token boolean">false</span>
coordinatorAddress = <span class="token string">&quot;THE-SMART-CONTRACT-EIP55-COORDINATOR-ADDRESS&quot;</span>
fromAddresses = <span class="token punctuation">[</span> <span class="token string">&quot;THE-CURRENT-NODE-EIP55-ADDRESS&quot;</span> <span class="token punctuation">]</span>
minIncomingConfirmations = <span class="token number">1</span>
publicKey = <span class="token string">&quot;THE-CURRENT-NODE-PUBLIC-KEY&quot;</span>
observationSource = <span class="token string">&quot;&quot;</span>&quot;
decode   <span class="token punctuation">[</span>type=<span class="token string">&quot;tvmabidecodelog&quot;</span><span class="token punctuation">]</span>
vrf      <span class="token punctuation">[</span>type=vrfbuilder<span class="token punctuation">]</span>
tvmcall  <span class="token punctuation">[</span>type=tvmcall contract=<span class="token string">&quot;THE-SMART-CONTRACT-TRON-ADDRESS&quot;</span> extractRevertReason=<span class="token boolean">true</span><span class="token punctuation">]</span>

decode-&gt;vrf-&gt;tvmcall
<span class="token string">&quot;&quot;</span>&quot;
</code></pre></div><p>With this, the node will be ready to handle incoming VRF requests.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/v2/doc/pricing.html" class="prev">
        WINkLink Price Feed Service
      </a></span> <span class="next"><a href="/v2/doc/anyapi.html">
        WINkLink AnyAPI Service
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/v2/doc/assets/js/app.03bfa769.js" defer></script><script src="/v2/doc/assets/js/2.a93bf3eb.js" defer></script><script src="/v2/doc/assets/js/1.449454cc.js" defer></script><script src="/v2/doc/assets/js/23.3063150b.js" defer></script>
  </body>
</html>
