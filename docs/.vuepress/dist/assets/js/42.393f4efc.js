(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{329:function(t,s,a){"use strict";a.r(s);var e=a(10),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"pipeline-tasks"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pipeline-tasks"}},[t._v("#")]),t._v(" Pipeline Tasks")]),t._v(" "),s("p",[t._v("Here we will discuss the more commonly used pipeline tasks. the TOML tasks are referenced through the "),s("code",[t._v("type")]),t._v(" parameter.")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img.shields.io/badge/http-blue",alt:"task"}}),t._v(" and "),s("img",{attrs:{src:"https://img.shields.io/badge/jsonparse-blue",alt:"task"}}),t._v(" are almost exclusively used together for calling an API and extracting the JSON results.")]),t._v(" "),s("div",{staticClass:"language-toml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-toml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# method=["GET", "POST"]')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# url="HTTP_REST_API"')]),t._v("\nds_http  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http"')]),t._v(" method"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("GET url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://mock-exchange.org?symbol=TRX_USDT"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# path=comma-separated-json-path. arrays can be accessed using the index number. e.g. "array,2"')]),t._v("\nds_parse "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jsonparse"')]),t._v(" path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"json,path,syntax"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[s("img",{attrs:{src:"https://img.shields.io/badge/convert--trx-blue",alt:"task"}}),t._v(" is a helper for doing a "),s("code",[t._v("http-GET")]),t._v(" and "),s("code",[t._v("jsonparse")]),t._v(" in one task")]),t._v(" "),s("div",{staticClass:"language-toml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-toml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# url="HTTP_REST_API"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# path=dot-separated-json-path *NOTE: dot separated syntax, which is different from jsonparse's comma separated syntax  ")]),t._v("\nds_converttrx "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"converttrx"')]),t._v(" url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://mock-exchange.org?symbol=TRX_USDT"')]),t._v(" path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"json.path.syntax"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[s("img",{attrs:{src:"https://img.shields.io/badge/convert--usd-blue",alt:"task"}}),t._v(" takes the "),s("code",[t._v("Input")]),t._v(" value from a prior "),s("code",[t._v("Pipeline.Task")]),t._v(" and does a "),s("strong",[s("u",[t._v("USDT")])]),t._v(" to "),s("strong",[s("u",[t._v("USD")])]),t._v(" conversion.")]),t._v(" "),s("div",{staticClass:"language-toml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-toml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# No other parameters required. Verified through a USDT/USD Aggregator smart contract  ")]),t._v("\nds_convertusd "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"convertusd"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[s("img",{attrs:{src:"https://img.shields.io/badge/convert--usdt-blue",alt:"task"}}),t._v(" takes the "),s("code",[t._v("Input")]),t._v(" value from a prior "),s("code",[t._v("Pipeline.Task")]),t._v(" and does a "),s("strong",[s("u",[t._v("USDT")])]),t._v(" to "),s("strong",[s("u",[t._v("TRX")])]),t._v(" conversion.")]),t._v(" "),s("div",{staticClass:"language-toml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-toml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# No other parameters required. Verified through a USDT/TRX SunSwap pool TRC20 token  ")]),t._v("\nds_convertusdt "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"convertusdt"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[s("img",{attrs:{src:"https://img.shields.io/badge/just--swap-blue",alt:"task"}}),t._v(' is used for manually inputting swap pairs that are not in our pre-defined list above ["USDT/USD", "USDT/TRX"]')]),t._v(" "),s("div",{staticClass:"language-toml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-toml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# poolAddr="SWAP_CONTRACT_T_ADDRESS"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# trx20Addr="TOKEN_CONTRACT_T_ADDRESS"')]),t._v("\nds_justswap "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"justswap"')]),t._v(" poolAddr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"TXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"')]),t._v(" trc20Addr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"TXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[s("img",{attrs:{src:"https://img.shields.io/badge/tvm--abi--decode--log-blue",alt:"task"}}),t._v(" is "),s("code",[t._v("VRF")]),t._v(" specific. It is assumed that "),s("code",[t._v("$jobRun.[logFn, logData, logTopics]")]),t._v(" are provided on job init. Read more in [winklink-libocr][libocr-link]")]),t._v(" "),s("div",{staticClass:"language-toml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-toml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# abi=The function abi. defaults to: RandomWordsRequested(type [indexed] name, ...)")]),t._v("\ndecode "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tvmabidecodelog"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[s("img",{attrs:{src:"https://img.shields.io/badge/vrf--builder-blue",alt:"task"}}),t._v(" is "),s("code",[t._v("VRF")]),t._v(" specific. It is assumed that "),s("code",[t._v("$jobSpec.[publicKey]")]),t._v(" & "),s("code",[t._v("$jobRun.[logBlockHash, logBlockNumber, logTopics]")]),t._v(" are provided on job init.")]),t._v(" "),s("div",{staticClass:"language-toml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-toml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# No other parameters required. It uses job parameters and event values to generate the result.[output, requestID, method, proof, requestCommitment] object  ")]),t._v("\nvrf "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("vrfbuilder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[s("img",{attrs:{src:"https://img.shields.io/badge/tvm--call-blue",alt:"task"}}),t._v(" is "),s("code",[t._v("VRF")]),t._v(" specific. It triggers the fulfillment contract call.")]),t._v(" "),s("div",{staticClass:"language-toml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-toml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# contract="VRF_CONTRACT_ADDRESS"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# extractRevertReason=Boolean. default: false. ON error, extract the reason to determine if it is a RPC or contract error.")]),t._v("\ntvmcall "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("tvmcall contract"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"TXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"')]),t._v(" extractRevertReason"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("h4",{attrs:{id:"examples"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#examples"}},[t._v("#")]),t._v(" Examples")]),t._v(" "),s("p",[t._v("In this example we show the tasks one might need to do a pair conversion from "),s("strong",[s("u",[t._v("LIVE to USD")])])]),t._v(" "),s("ol",[s("li",[t._v("Broadcaster schedules a pipeline run")]),t._v(" "),s("li",[t._v("SunSwap LIVE/TRX")]),t._v(" "),s("li",[t._v("Convert USDT/TRX")]),t._v(" "),s("li",[t._v("Multiply the results (6 decimal places as per your needs)")]),t._v(" "),s("li",[t._v("Convert result USDT/USD")])]),t._v(" "),s("div",{staticClass:"language-toml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-toml"}},[s("code",[t._v("ds_justswap     "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"justswap"')]),t._v(" poolAddr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"TXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"')]),t._v(" trc20Addr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"TXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nds_convertusdt  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"convertusdt"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nds_multiply     "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"multiply"')]),t._v(" times"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nds_convertusd   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"convertusd"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\nds_justswap -> ds_convertusdt -> ds_multiply -> ds_convertusd\n")])])]),s("p",[t._v("The following example is for a "),s("strong",[s("u",[t._v("VRF")])]),t._v(" scenario")]),t._v(" "),s("ol",[s("li",[t._v("Broadcaster picked up a VRF RandomWordsRequested(...) event from the chain and schedules a pipeline run")]),t._v(" "),s("li",[t._v("The abi, data and event logs are decoded")]),t._v(" "),s("li",[t._v("The proof and random number is cryptographically generated")]),t._v(" "),s("li",[t._v("The callback to the smart contract is made with "),s("code",[t._v("RequestFulfilled")]),t._v(" and "),s("code",[t._v("RandomWordsFulfilled")])])]),t._v(" "),s("div",{staticClass:"language-toml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-toml"}},[s("code",[t._v("decode   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tvmabidecodelog"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nvrf      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("vrfbuilder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\ntvmcall  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("tvmcall contract"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"TXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"')]),t._v(" extractRevertReason"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\ndecode -> vrf -> tvmcall\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);