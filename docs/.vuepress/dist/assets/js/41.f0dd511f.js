(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{331:function(t,s,a){"use strict";a.r(s);var n=a(10),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"管線任務"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#管線任務"}},[t._v("#")]),t._v(" 管線任務")]),t._v(" "),s("p",[t._v("我們在此以更為常見的管線任務為例進行討論。 TOML 文件中的任務可使用 "),s("code",[t._v("type")]),t._v(" 參數進行分類。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img.shields.io/badge/http-blue",alt:"task"}}),t._v(" 和 "),s("img",{attrs:{src:"https://img.shields.io/badge/jsonparse-blue",alt:"task"}}),t._v(" 基本上一起使用，主要用於調用 API 和提取 JSON 結果。")]),t._v(" "),s("div",{staticClass:"language-toml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-toml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# method=["GET", "POST"]')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# url="HTTP_REST_API"')]),t._v("\nds_http  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http"')]),t._v(" method"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("GET url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://mock-exchange.org?symbol=TRX_USDT"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# path=comma-separated-json-path. arrays can be accessed using the index number. e.g. "array,2"')]),t._v("\nds_parse "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jsonparse"')]),t._v(" path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"json,path,syntax"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[s("img",{attrs:{src:"https://img.shields.io/badge/convert--trx-blue",alt:"task"}}),t._v(" 用於執行任務中的 "),s("code",[t._v("http-GET")]),t._v(" 和 "),s("code",[t._v("jsonparse")]),t._v(" 操作")]),t._v(" "),s("div",{staticClass:"language-toml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-toml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# url="HTTP_REST_API"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# path=dot-separated-json-path *NOTE: dot separated syntax, which is different from jsonparse's comma separated syntax  ")]),t._v("\nds_converttrx "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"converttrx"')]),t._v(" url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://mock-exchange.org?symbol=TRX_USDT"')]),t._v(" path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"json.path.syntax"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[s("img",{attrs:{src:"https://img.shields.io/badge/convert--usd-blue",alt:"task"}}),t._v(" 從上一個管線任務（"),s("code",[t._v("Pipeline.Task")]),t._v("）獲取輸入值，然後進行一次 "),s("strong",[s("u",[t._v("USDT")])]),t._v(" 到 "),s("strong",[s("u",[t._v("USD")])]),t._v(" 的轉換。")]),t._v(" "),s("div",{staticClass:"language-toml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-toml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# No other parameters required. Verified through a USDT/USD Aggregator smart contract  ")]),t._v("\nds_convertusd "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"convertusd"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[s("img",{attrs:{src:"https://img.shields.io/badge/convert--usdt-blue",alt:"task"}}),t._v(" 從上一個管線任務（"),s("code",[t._v("Pipeline.Task")]),t._v("）獲取輸入值，然後進行一次 "),s("strong",[s("u",[t._v("USDT")])]),t._v(" 到 "),s("strong",[s("u",[t._v("TRX")])]),t._v(" 的轉換。")]),t._v(" "),s("div",{staticClass:"language-toml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-toml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# No other parameters required. Verified through a USDT/TRX SunSwap pool TRC20 token  ")]),t._v("\nds_convertusdt "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"convertusdt"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[s("img",{attrs:{src:"https://img.shields.io/badge/just--swap-blue",alt:"task"}}),t._v(' 用於手動輸入不在我們上述預定義列表中的兌換幣對（“USDT/USD”和"USDT/TRX“）')]),t._v(" "),s("div",{staticClass:"language-toml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-toml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# poolAddr="SWAP_CONTRACT_T_ADDRESS"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# trx20Addr="TOKEN_CONTRACT_T_ADDRESS"')]),t._v("\nds_justswap "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"justswap"')]),t._v(" poolAddr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"TXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"')]),t._v(" trc20Addr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"TXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[s("img",{attrs:{src:"https://img.shields.io/badge/tvm--abi--decode--log-blue",alt:"task"}}),t._v(" 是專供 "),s("code",[t._v("VRF")]),t._v(" 使用的方法。 我們假設任務在初始化時會提供變量 "),s("code",[t._v("$jobRun.[logFn, logData, logTopics]")]),t._v("。 詳情請參考 [winklink-libocr][libocr-link]")]),t._v(" "),s("div",{staticClass:"language-toml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-toml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# abi=The function abi. defaults to: RandomWordsRequested(type [indexed] name, ...)")]),t._v("\ndecode "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tvmabidecodelog"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[s("img",{attrs:{src:"https://img.shields.io/badge/vrf--builder-blue",alt:"task"}}),t._v(" 是專供 "),s("code",[t._v("VRF")]),t._v(" 使用的方法。 我們假設任務在初始化時會提供變量 "),s("code",[t._v("$jobSpec.[publicKey] 以及 $jobRun.[logBlockHash, logBlockNumber, logTopics]")]),t._v("。")]),t._v(" "),s("div",{staticClass:"language-toml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-toml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# No other parameters required. It uses job parameters and event values to generate the result.[output, requestID, method, proof, requestCommitment] object  ")]),t._v("\nvrf "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("vrfbuilder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[s("img",{attrs:{src:"https://img.shields.io/badge/tvm--call-blue",alt:"task"}}),t._v(" 是專供 "),s("code",[t._v("VRF")]),t._v(" 使用的方法， 可觸發調用合約中的 fulfillment 方法。")]),t._v(" "),s("div",{staticClass:"language-toml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-toml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# contract="VRF_CONTRACT_ADDRESS"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# extractRevertReason=Boolean. default: false. ON error, extract the reason to determine if it is a RPC or contract error.")]),t._v("\ntvmcall "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("tvmcall contract"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"TXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"')]),t._v(" extractRevertReason"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("h4",{attrs:{id:"示例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#示例"}},[t._v("#")]),t._v(" 示例")]),t._v(" "),s("p",[t._v("以下例子展示了從 "),s("strong",[s("u",[t._v("LIVE 到 USD")])]),t._v(" 這一幣對轉化所需完成的任務。")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("Broadcaster規劃一個 pipeline 任務")])]),t._v(" "),s("li",[s("p",[t._v("LIVE/TRX SunSwap 兌換")])]),t._v(" "),s("li",[s("p",[t._v("TRX/USDT 轉換")])]),t._v(" "),s("li",[s("p",[t._v("將結果相乘（根據您的需求可設置 6 位小數位）")])]),t._v(" "),s("li",[s("p",[t._v("將 USDT 價格對的結果轉化為 USD 價格對")])])]),t._v(" "),s("div",{staticClass:"language-toml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-toml"}},[s("code",[t._v("ds_justswap     "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"justswap"')]),t._v(" poolAddr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"TXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"')]),t._v(" trc20Addr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"TXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nds_convertusdt  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"convertusdt"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nds_multiply     "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"multiply"')]),t._v(" times"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nds_convertusd   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"convertusd"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\nds_justswap -> ds_convertusdt -> ds_multiply -> ds_convertusd\n")])])]),s("p",[t._v("以下例子是針對 "),s("strong",[s("u",[t._v("VRF")])]),t._v(" 的場景")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("廣播者從鏈上接收一個 VRF RandomWordsRequested(...) 事件，並規劃一個管線任務")])]),t._v(" "),s("li",[s("p",[t._v("解碼 ABI、數據和事件日誌")])]),t._v(" "),s("li",[s("p",[t._v("加密生成證明和隨機數")])]),t._v(" "),s("li",[s("p",[t._v("智能合約的回調通過 "),s("code",[t._v("RequestFulfilled")]),t._v(" 和 "),s("code",[t._v("RandomWordsFulfilled")]),t._v(" 實現")])])]),t._v(" "),s("div",{staticClass:"language-toml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-toml"}},[s("code",[t._v("decode   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tvmabidecodelog"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nvrf      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("vrfbuilder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\ntvmcall  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("tvmcall contract"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"TXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"')]),t._v(" extractRevertReason"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\ndecode -> vrf -> tvmcall\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);