(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{321:function(t,s,a){"use strict";a.r(s);var n=a(10),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"管线任务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#管线任务"}},[t._v("#")]),t._v(" 管线任务")]),t._v(" "),s("p",[t._v("我们在此以更为常见的管线任务为例进行讨论。 TOML 文件中的任务可使用 “type” 参数进行分类。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://img.shields.io/badge/http-blue",alt:"task"}}),t._v(" 和 "),s("img",{attrs:{src:"https://img.shields.io/badge/jsonparse-blue",alt:"task"}}),t._v(" 基本上一起使用，主要用于调用 API 和提取 JSON 结果。")]),t._v(" "),s("div",{staticClass:"language-toml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-toml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# method=["GET", "POST"]')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# url="HTTP_REST_API"')]),t._v("\nds_http  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http"')]),t._v(" method"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("GET url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://mock-exchange.org?symbol=TRX_USDT"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# path=comma-separated-json-path. arrays can be accessed using the index number. e.g. "array,2"')]),t._v("\nds_parse "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jsonparse"')]),t._v(" path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"json,path,syntax"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[s("img",{attrs:{src:"https://img.shields.io/badge/convert--trx-blue",alt:"task"}}),t._v(" 用于执行任务中的 "),s("code",[t._v("http-GET")]),t._v(" 和 "),s("code",[t._v("jsonparse")]),t._v(" 操作")]),t._v(" "),s("div",{staticClass:"language-toml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-toml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# url="HTTP_REST_API"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# path=dot-separated-json-path *NOTE: dot separated syntax, which is different from jsonparse's comma separated syntax  ")]),t._v("\nds_converttrx "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"converttrx"')]),t._v(" url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://mock-exchange.org?symbol=TRX_USDT"')]),t._v(" path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"json.path.syntax"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[s("img",{attrs:{src:"https://img.shields.io/badge/convert--usd-blue",alt:"task"}}),t._v(" 从上一个管线任务（"),s("code",[t._v("Pipeline.Task")]),t._v("）获取输入值，然后进行一次 "),s("strong",[s("u",[t._v("USDT")])]),t._v(" 到 "),s("strong",[s("u",[t._v("USD")])]),t._v(" 的转换。")]),t._v(" "),s("div",{staticClass:"language-toml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-toml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# No other parameters required. Verified through a USDT/USD Aggregator smart contract  ")]),t._v("\nds_convertusd "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"convertusd"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[s("img",{attrs:{src:"https://img.shields.io/badge/convert--usdt-blue",alt:"task"}}),t._v(" 从上一个管线任务（"),s("code",[t._v("Pipeline.Task")]),t._v("）中获取输入值，然后进行一次 "),s("strong",[s("u",[t._v("USDT")])]),t._v(" 到 "),s("strong",[s("u",[t._v("TRX")])]),t._v(" 的转换。")]),t._v(" "),s("div",{staticClass:"language-toml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-toml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# No other parameters required. Verified through a USDT/TRX SunSwap pool TRC20 token  ")]),t._v("\nds_convertusdt "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"convertusdt"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[s("img",{attrs:{src:"https://img.shields.io/badge/just--swap-blue",alt:"task"}}),t._v(' 用于手动输入不在我们上述预定义列表中的兑换币对（“USDT/USD”和"USDT/TRX“）')]),t._v(" "),s("div",{staticClass:"language-toml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-toml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# poolAddr="SWAP_CONTRACT_T_ADDRESS"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# trx20Addr="TOKEN_CONTRACT_T_ADDRESS"')]),t._v("\nds_justswap "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"justswap"')]),t._v(" poolAddr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"TXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"')]),t._v(" trc20Addr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"TXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[s("img",{attrs:{src:"https://img.shields.io/badge/tvm--abi--decode--log-blue",alt:"task"}}),t._v(" 是专供 "),s("code",[t._v("VRF")]),t._v(" 使用的方法。 我们假设任务在初始化时会提供变量 "),s("code",[t._v("$jobRun.[logFn, logData, logTopics]")]),t._v("。 详情请参考 [winklink-libocr][libocr-link]")]),t._v(" "),s("div",{staticClass:"language-toml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-toml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# abi=The function abi. defaults to: RandomWordsRequested(type [indexed] name, ...)")]),t._v("\ndecode "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tvmabidecodelog"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[s("img",{attrs:{src:"https://img.shields.io/badge/vrf--builder-blue",alt:"task"}}),t._v(" 是专供 "),s("code",[t._v("VRF")]),t._v(" 使用的方法。 我们假设任务在初始化时会提供变量 "),s("code",[t._v("$jobSpec.[publicKey]")]),t._v(" 以及 "),s("code",[t._v("$jobRun.[logBlockHash, logBlockNumber, logTopics]")]),t._v("。")]),t._v(" "),s("div",{staticClass:"language-toml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-toml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# No other parameters required. It uses job parameters and event values to generate the result.[output, requestID, method, proof, requestCommitment] object  ")]),t._v("\nvrf "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("vrfbuilder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[s("img",{attrs:{src:"https://img.shields.io/badge/tvm--call-blue",alt:"task"}}),t._v(" 是专供 "),s("code",[t._v("VRF")]),t._v(" 使用的方法， 可触发调用合约中的 fulfillment 方法。")]),t._v(" "),s("div",{staticClass:"language-toml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-toml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# contract="VRF_CONTRACT_ADDRESS"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# extractRevertReason=Boolean. default: false. ON error, extract the reason to determine if it is a RPC or contract error.")]),t._v("\ntvmcall "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("tvmcall contract"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"TXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"')]),t._v(" extractRevertReason"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("h4",{attrs:{id:"示例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#示例"}},[t._v("#")]),t._v(" 示例")]),t._v(" "),s("p",[t._v("以下例子展示了从 "),s("strong",[s("u",[t._v("LIVE 到 USD")])]),t._v(" 这一币对转化所需完成的任务。")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("Broadcaster规划一个 pipeline 任务")])]),t._v(" "),s("li",[s("p",[t._v("LIVE/TRX SunSwap 兑换")])]),t._v(" "),s("li",[s("p",[t._v("TRX/USDT 转换")])]),t._v(" "),s("li",[s("p",[t._v("将结果相乘（根据您的需求可设置 6 位小数位）")])]),t._v(" "),s("li",[s("p",[t._v("将 USDT 价格对的结果转化为 USD 价格对")])])]),t._v(" "),s("div",{staticClass:"language-toml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-toml"}},[s("code",[t._v("ds_justswap     "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"justswap"')]),t._v(" poolAddr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"TXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"')]),t._v(" trc20Addr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"TXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nds_convertusdt  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"convertusdt"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nds_multiply     "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"multiply"')]),t._v(" times"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nds_convertusd   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"convertusd"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\nds_justswap -> ds_convertusdt -> ds_multiply -> ds_convertusd\n")])])]),s("p",[t._v("以下例子是针对 "),s("strong",[s("u",[t._v("VRF")])]),t._v(" 的场景")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("广播者从链上接收一个 VRF RandomWordsRequested(...) 事件，并规划一个管线任务")])]),t._v(" "),s("li",[s("p",[t._v("解码 ABI、数据和事件日志")])]),t._v(" "),s("li",[s("p",[t._v("加密生成证明和随机数")])])]),t._v(" "),s("p",[t._v("智能合约的回调通过 "),s("code",[t._v("RequestFulfilled")]),t._v(" 和 "),s("code",[t._v("RandomWordsFulfilled")]),t._v(" 实现")]),t._v(" "),s("div",{staticClass:"language-toml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-toml"}},[s("code",[t._v("decode   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tvmabidecodelog"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nvrf      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("vrfbuilder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\ntvmcall  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("tvmcall contract"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"TXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"')]),t._v(" extractRevertReason"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\ndecode -> vrf -> tvmcall\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);